Vagrant.configure("2") do |config|
  # Utiliser une distribution Linux, par exemple Ubuntu
  config.vm.box = "ubuntu/xenial64"
  config.vm.hostname = "jenkins-master"

  # Redirection de port pour accéder à Jenkins (port 8080)
  config.vm.network "forwarded_port", guest: 8080, host: 8080

  # Redirection de port pour accéder au site web (port 80)
  config.vm.network "forwarded_port", guest: 80, host: 8000 # On mappe le port 80 de la VM sur le port 8000 de l'hôte

  # Provisionnement : Installer Java, Jenkins et Apache/Nginx (Optionnel : si le site est déployé sur la même VM)
  config.vm.provision "shell", inline: <<-SHELL
    # Mise à jour et installation des dépendances (Java est requis pour Jenkins)
    sudo apt-get update
    sudo apt-get install -y openjdk-8-jdk wget

    # Installation de Jenkins
    wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -
    sudo sh -c 'echo deb https://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
    sudo apt-get update
    sudo apt-get install -y jenkins

    # Installation d'un serveur web (par exemple Nginx) pour le déploiement du site
    sudo apt-get install -y nginx

    # Démarrer le service Jenkins et Nginx
    sudo systemctl start jenkins
    sudo systemctl enable jenkins
    sudo systemctl start nginx
    sudo systemctl enable nginx
  SHELL

end
